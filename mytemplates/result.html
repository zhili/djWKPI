{% extends "base.html" %}
{% block extrahead %}
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Ucell KPI App</title>
	<meta name="author" content="zhili hu">
	<link rel="stylesheet" href="/polls/site_media/datatable.css" type="text/css" media="print, projection, screen" />
	<link rel="stylesheet" href="/polls/site_media/redmond/jquery-ui-1.8.6.custom.css" type="text/css"/>
	<link rel="stylesheet" href="/polls/site_media/demo_table_jui.css" type="text/css" />
	<link rel="stylesheet" href="/polls/site_media/datepicker/ui.daterangepicker.css" type="text/css" />
	<style type="text/css" title="currentStyle"> 
          .ui-tabs .ui-tabs-panel { padding: 10px }
	</style>

	
    <script type="text/javascript" src="/polls/site_media/jquery.dataTables.min.js"></script>
	<script src="/polls/site_media/jquery-ui-1.8.6.custom.min.js"></script>
	<script src="/polls/site_media/jquery.ui.tabs.js"></script>
	<script type="text/javascript" src="/polls/site_media/datepicker/daterangepicker.jQuery.js"></script> 
	<script type="text/javascript">	
		$(function(){
			if($(window.parent.document).find('iframe').size()){
				var inframe = true;
			}
			 $("#id_startDate, #id_endDate").daterangepicker({
				posY: '178px', // add this for initializing the panel position.  
				dateFormat: 'mm/dd/yy',
			 	onOpen:function(){ if(inframe){ $(window.parent.document).find('iframe:eq(0)').width(700).height('35em');} }, 
			  	onClose: function(){ if(inframe){ $(window.parent.document).find('iframe:eq(0)').width('100%').height('5em');} }
			 }); 

		 });
	</script>
	<script type="text/javascript" charset="utf-8"> 
		$(document).ready( function () {
			var table_initialised4 = false;var table_initialised5 = false;var table_initialised6 = false;var table_initialised7 = false;
			var oTable4; var oTable5;var oTable6;var oTable7;
			$("#tabs").tabs( {
							"show": function(event, ui) {
								var oTable = $('div.dataTables_scrollBody>table.display', ui.panel).dataTable();
								if ( oTable.length > 0 ) {
									oTable.fnAdjustColumnSizing();
								}
								var oTable1 = $('div.dataTables_scrollBody>table.extra', ui.panel).dataTable();
								if ( oTable1.length > 0 ) {
									oTable1.fnAdjustColumnSizing();
								}
							}
						} );
			$('table.display').dataTable( {
								"sDom": '<"H"Cfr>t<"F"ip>',
								// "sScrollX": "100%",
								// "sScrollXInner": "110%",
								"bScrollCollapse": true,
								"bPaginate": false,
								"bJQueryUI": true,
								"aaSorting": [],
								// "oLanguage": {
								// "sSearch": "Custom filter:"
								// },
								"bFilter": false,
								// "aoColumnDefs": [
								// 	{ "sWidth": "10%", "aTargets": [ -1 ] }
								// ]
							} );
			$('#tabs').bind('tabsselect', function(event, ui) {

				if (ui.index == 3) {
					if (table_initialised4 == false) {
					    //build the table from scratch
					    table_initialised4 = true;
						// $.fn.dataTableExt.iApiIndex = 1;  
				 		oTable4 = $('#example4').dataTable({
							"sDom": '<"H"Cfr>t<"F"ip>',
							"sScrollX": "100%",
							"sScrollXInner": "134%",
							"bScrollCollapse": true,
							"bPaginate": false,
							"bJQueryUI": true,
							"aaSorting": [],
							// "oLanguage": {
							// 	"sSearch": "Custom filter:"
							// },
							"bFilter": false,
							"bProcessing": true,
							// "bServerSide": true,
							"sAjaxSource": "/polls/extrajson/{{cell_name}}/1/",
							"fnServerData": function ( sSource, aoData, fnCallback ) {
												/* Add some extra data to the sender */
												var startDate = document.getElementById("id_startDate").value;
												var endDate = document.getElementById("id_endDate").value
												aoData.push( { "name": "sdate", "value": startDate});
												aoData.push( { "name": "edate", "value": endDate});
												$.getJSON( sSource, aoData, function (json) { 
													/* Do whatever additional processing you want on the callback, then tell DataTables */
													fnCallback(json);
												} );
											}
						});
					} else {
					    //redraw the table
					    // oTable4.fnDraw();
					}
				};
				if (ui.index == 4) {
					if (table_initialised5 == false) {
					    //build the table from scratch
					    table_initialised5 = true;
						// $.fn.dataTableExt.iApiIndex = 1;  
				 		oTable5 = $('#example5').dataTable({
							"sDom": '<"H"Cfr>t<"F"ip>',
							"sScrollX": "100%",
							"sScrollXInner": "127%",
							"bScrollCollapse": true,
							"bPaginate": false,
							"bJQueryUI": true,
							"aaSorting": [],
							// "oLanguage": {
							// 	"sSearch": "Custom filter:"
							// },
							"bFilter": false,
							"bProcessing": true,
							// "bServerSide": true,
							"sAjaxSource": "/polls/extrajson/{{cell_name}}/2/",
							"fnServerData": function ( sSource, aoData, fnCallback ) {
												/* Add some extra data to the sender */
												var startDate = document.getElementById("id_startDate").value;
												var endDate = document.getElementById("id_endDate").value
												aoData.push( { "name": "sdate", "value": startDate});
												aoData.push( { "name": "edate", "value": endDate});
												$.getJSON( sSource, aoData, function (json) { 
													/* Do whatever additional processing you want on the callback, then tell DataTables */
													fnCallback(json);
												} );
											}
						});
					} else {
					    //redraw the table
					    // oTable4.fnDraw();
					}
				};
				if (ui.index == 5) {
					if (table_initialised6 == false) {
					    //build the table from scratch
					    table_initialised6 = true;
						// $.fn.dataTableExt.iApiIndex = 1;  
				 		oTable6 = $('#example6').dataTable({
							"sDom": '<"H"Cfr>t<"F"ip>',
							"sScrollX": "100%",
							"sScrollXInner": "130%",
							"bScrollCollapse": true,
							"bPaginate": false,
							"bJQueryUI": true,
							"aaSorting": [],
							// "oLanguage": {
							// 	"sSearch": "Custom filter:"
							// },
							"bFilter": false,
							"bProcessing": true,
							// "bServerSide": true,
							"sAjaxSource": "/polls/extrajson/{{cell_name}}/3/",
							"fnServerData": function ( sSource, aoData, fnCallback ) {
												/* Add some extra data to the sender */
												var startDate = document.getElementById("id_startDate").value;
												var endDate = document.getElementById("id_endDate").value
												aoData.push( { "name": "sdate", "value": startDate});
												aoData.push( { "name": "edate", "value": endDate});
												$.getJSON( sSource, aoData, function (json) { 
													/* Do whatever additional processing you want on the callback, then tell DataTables */
													fnCallback(json);
												} );
											}
						});
					} else {
					    //redraw the table
					    // oTable4.fnDraw();
					}
				};
				if (ui.index == 6) {
					if (table_initialised7 == false) {
					    //build the table from scratch
					    table_initialised7 = true;
						// $.fn.dataTableExt.iApiIndex = 1;  
				 		oTable7 = $('#example7').dataTable({
							"sDom": '<"H"Cfr>t<"F"ip>',
							"sScrollX": "100%",
							"sScrollXInner": "130%",
							"bScrollCollapse": true,
							"bPaginate": false,
							"bJQueryUI": true,
							"aaSorting": [],
							// "oLanguage": {
							// 	"sSearch": "Custom filter:"
							// },
							"bFilter": false,
							"bProcessing": true,
							// "bServerSide": true,
							"sAjaxSource": "/polls/extrajson/{{cell_name}}/4/",
							"fnServerData": function ( sSource, aoData, fnCallback ) {
												/* Add some extra data to the sender */
												var startDate = document.getElementById("id_startDate").value;
												var endDate = document.getElementById("id_endDate").value
												aoData.push( { "name": "sdate", "value": startDate});
												aoData.push( { "name": "edate", "value": endDate});
												$.getJSON( sSource, aoData, function (json) { 
													/* Do whatever additional processing you want on the callback, then tell DataTables */
													fnCallback(json);
												} );
											}
						});
					} else {
					    //redraw the table
					    // oTable4.fnDraw();
					}
				};
			  });
		} );
	</script>
	<script type="text/javascript" src="/polls/site_media/swfobject.js"></script>
    <script type="text/javascript">
		$(document).ready( function () {	
 		   	// swfobject.embedSWF(
 		   	// 		      	  "/polls/site_media/open-flash-chart.swf", "chart_total",
 		   	// 		      	  "600", "300", "9.0.0", "/polls/site_media/expressInstall.swf",
 		   	// 		      	  {"data-file":"/polls/{{cell_name}}/data/"} );
			var durl = ["/polls/{{cell_name}}/data/", [["sdate", document.getElementById("id_startDate").value].join('='), ["edate", document.getElementById("id_endDate").value].join('=')].join("&")].join("?");
			// console.log(durl)
	    	swfobject.embedSWF(
		    	  "/polls/site_media/open-flash-chart.swf", "chart_me",
		    	  "600", "340", "9.0.0", "/polls/site_media/expressInstall.swf",
		    	  {"data-file":encodeURIComponent(durl)});
  				// var endDate = new Date(document.getElementById("id_endDate").value);
				// console.log(encodeURIComponent(document.getElementById("id_endDate").value));
			
			var durl_1 = ["/polls/{{cell_name}}/1/data/", [["sdate", document.getElementById("id_startDate").value].join('='), ["edate", document.getElementById("id_endDate").value].join('=')].join("&")].join("?");
	    	swfobject.embedSWF(
	    	  "/polls/site_media/open-flash-chart.swf", "chart_extra",
	    	  "600", "340", "9.0.0", "/polls/site_media/expressInstall.swf",
	    	  {"data-file":encodeURIComponent(durl_1)});
		});
    </script>
{% endblock %}

{% block content %}
	<h1>{{cell_name}} Analysis</h1>
  	<div id="main">
		<div id = 'selecteddate'>
			<form action="/polls/results/{{cell_name}}" method="post">
			{% csrf_token %}
				{{form}}
				<input type="submit" value="Go" />  
			</form>
		</div>
		<div id="tabs"> 
			<ul> 
				<li><a href="#tabs-1">Drop Call</a></li> 
				<li><a href="#tabs-2">HandOver</a></li> 
				<li><a href="#tabs-3">Traffic Vol</a></li>
				<li><a href="#tabs-4">HSDPA</a></li>
				<li><a href="#tabs-5">HSUPA</a></li>
				<li><a href="#tabs-6">RRC All</a></li>
				<li><a href="#tabs-7">RAB All</a></li>
			</ul>
			<div id="tabs-1"> 
				<table cellspacing="0" cellspacing="0" border="0" class="display" id="example1">
					<thead> 
						<tr> 		
					    {% for col in dc_head %}
					    	<th>{{col}}</th>
					    {% endfor %}
						</tr> 
					</thead> 
					<tbody>

			          	{% for rate in cate_dc %}
							 <tr>
								<td>{{cell_name}}</td>
								{% for col in rate %}
								   <td> {{ col }}</td>
								{% endfor %}
							 </tr> 
						{% endfor %}

					</tbody>
				</table>
			</div>
			<div id="tabs-2"> 
				<table cellpadding="0" cellspacing="0" border="0" class="display" id="example2">
					<thead> 
						<tr> 		
					    {% for col in ho_head %}
					    	<th>{{col}}</th>
					    {% endfor %}
						</tr> 
					</thead> 
					<tbody>

			          	{% for rate in cate_ho %}
							 <tr>
								<td>{{cell_name}}</td>
								{% for col in rate %}
								   <td> {{ col }}</td>
								{% endfor %}
							 </tr> 
						{% endfor %}

					</tbody>
				</table>
			</div>
			<div id="tabs-3"> 
				<table cellspacing="0" cellspacing="0" border="0" class="display" id="example3">
					<thead> 
						<tr> 		
					    {% for col in tv_head %}
					    	<th>{{col}}</th>
					    {% endfor %}
						</tr> 
					</thead> 
					<tbody>

			          	{% for rate in cate_tv %}
							 <tr>
								<td>{{cell_name}}</td>
								{% for col in rate %}
								   <td> {{ col }}</td>
								{% endfor %}
							 </tr> 
						{% endfor %}

					</tbody>
				</table>
			</div>
			<div id="tabs-4">
				<table cellspacing="0" cellspacing="0" border="0" class="extra" id="example4">
					<thead> 
						<tr>
							<tr> 		
						    {% for col in hsdpa_head %}
						    	<th>{{col}}</th>
						    {% endfor %}
							</tr>	
						</tr> 
					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
			<div id="tabs-5">
				<table cellspacing="0" cellspacing="0" border="0" class="extra" id="example5">
					<thead> 
						<tr>
							<tr> 		
						    {% for col in hsupa_head %}
						    	<th>{{col}}</th>
						    {% endfor %}
							</tr>	
						</tr> 
					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
			<div id="tabs-6">
				<table cellspacing="0" cellspacing="0" border="0" class="extra" id="example6">
					<thead> 
						<tr>
							<tr> 		
						    {% for col in rrc_head %}
						    	<th>{{col}}</th>
						    {% endfor %}
							</tr>	
						</tr> 
					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
			<div id="tabs-7">
				<table cellspacing="0" cellspacing="0" border="0" class="extra" id="example7">
					<thead> 
						<tr>
							<tr> 		
						    {% for col in rab_head %}
						    	<th>{{col}}</th>
						    {% endfor %}
							</tr>	
						</tr> 
					</thead>
					<tbody>

					</tbody>
				</table>
			</div>
  
		</div>
	</div>
	<div class="chart" id="chart_me"></div>
	<div class="chart" id="chart_extra"></div>
{% endblock %}